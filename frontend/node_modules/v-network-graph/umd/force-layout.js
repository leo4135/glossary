(function(a,s){typeof exports=="object"&&typeof module!="undefined"?s(exports,require("vue"),require("d3-force")):typeof define=="function"&&define.amd?define(["exports","vue","d3-force"],s):(a=typeof globalThis!="undefined"?globalThis:a||self,s(a.VNetworkGraphForceLayout={},a.Vue,a.d3))})(this,function(a,s,d){"use strict";var F=Object.defineProperty,V=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var w=(a,s,d)=>s in a?F(a,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):a[s]=d,j=(a,s)=>{for(var d in s||(s={}))B.call(s,d)&&w(a,d,s[d]);if(D)for(var d of D(s))G.call(s,d)&&w(a,d,s[d]);return a},E=(a,s)=>V(a,A(s));function P(v){const i=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(v){for(const t in v)if(t!=="default"){const o=Object.getOwnPropertyDescriptor(v,t);Object.defineProperty(i,t,o.get?o:{enumerable:!0,get:()=>v[t]})}}return i.default=v,Object.freeze(i)}const x=P(d);class O{constructor(i={}){this.options=i}activate(i){const{nodePositions:t,nodes:o,edges:c,emitter:r}=i;let{nodeLayouts:h,nodeLayoutMap:p}=this.buildNodeLayouts(o.value,t);const g=this.createSimulation(h,this.forceLayoutEdges(c.value,o.value));this.onTick=()=>{var n,y,u,e,l;for(const f of h){const k=(n=t.value)==null?void 0:n[f.id];if(k){const S=(y=f.x)!=null?y:0,T=(u=f.y)!=null?u:0;(k.x!==S||k.y!==T)&&Object.assign(k,{x:S,y:T})}else t.value[f.id]={x:(e=f.x)!=null?e:0,y:(l=f.y)!=null?l:0}}},g.on("tick",this.onTick),this.onTick();const m=()=>{this.options.noAutoRestartSimulation||g.alpha(.1).restart()},b=n=>{var y;if(this.options.noAutoRestartSimulation)for(const[u,e]of Object.entries(n)){const l=(y=t.value)==null?void 0:y[u];l.x=e.x,l.y=e.y}else{for(const[u,e]of Object.entries(n)){const l=p[u];l.fx=e.x,l.fy=e.y}m()}},L=n=>{var y;for(const[u,e]of Object.entries(n)){const l=this.getNodeLayout(t,u),f=(y=p==null?void 0:p[u])!=null?y:{x:0,y:0};l.value.fixed||this.options.positionFixedByDrag?(f.fx=e.x,f.fy=e.y,l.value.fixed=!0):(f.x=e.x,f.y=e.y,delete f.fx,delete f.fy)}m()},N=({node:n,event:y})=>{if(this.options.positionFixedByClickWithAltKey&&y.altKey){const u=this.getNodeLayout(t,n);let e=p==null?void 0:p[n];e||(e={id:n,x:0,y:0},p[n]=e),u.value.fixed?(delete u.value.fixed,e.x=e.fx||e.x,e.y=e.fy||e.y,delete e.fx,delete e.fy):(u.value.fixed=!0,e.fx=e.x,e.fy=e.y),m()}},C=s.watch(()=>[Object.keys(o.value),Object.keys(t.value),Object.values(c.value).map(n=>`${n.source}=${n.target}`),Object.values(t.value).map(n=>n.fixed)],()=>{({nodeLayouts:h,nodeLayoutMap:p}=this.buildNodeLayouts(o.value,t)),g.nodes(h);const n=g.force("edge");n&&n.links(this.forceLayoutEdges(c.value,o.value)),m()});r.on("node:dragstart",b),r.on("node:pointermove",b),r.on("node:dragend",L),r.on("node:click",N),this.onDeactivate=()=>{g.stop(),C(),r.off("node:dragstart",b),r.off("node:pointermove",b),r.off("node:dragend",L),r.off("node:click",N)}}deactivate(){this.onDeactivate&&this.onDeactivate(),this.onTick=void 0}ticked(){var i;(i=this.onTick)==null||i.call(this)}createSimulation(i,t){if(this.options.createSimulation)return this.options.createSimulation(x,i,t);{const o=x.forceLink(t).id(c=>c.id);return x.forceSimulation(i).force("edge",o.distance(100)).force("charge",x.forceManyBody()).force("collide",x.forceCollide(50).strength(.2)).force("center",x.forceCenter().strength(.05)).alphaMin(.001)}}buildNodeLayouts(i,t){const o=Object.keys(i).filter(h=>!(h in t.value)),c=this.forceNodeLayouts(t.value,o),r=Object.fromEntries(c.map(h=>[h.id,h]));return{nodeLayouts:c,nodeLayoutMap:r}}forceNodeLayouts(i,t){const o=Object.entries(i).map(([c,r])=>r.fixed?E(j({id:c},r),{fx:r.x,fy:r.y}):j({id:c},r));return t.map(c=>({id:c})).forEach(c=>o.push(c)),o}forceLayoutEdges(i,t){return Object.values(i).filter(o=>o.source in t&&o.target in t).map(o=>({source:o.source,target:o.target}))}getNodeLayout(i,t){const o=s.toRef(i.value,t);return o.value||(o.value={x:0,y:0}),o}}globalThis.VNetworkGraph&&Object.assign(globalThis.VNetworkGraph,{ForceLayout:O});const _={ForceLayout:O};a.default=_,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=force-layout.js.map
